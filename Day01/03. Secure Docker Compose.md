# Secure Docker Compose Configuration

This configuration demonstrates best practices for hardening containers using Docker Compose. It applies:

- Linux Capabilities (`cap_add`, `cap_drop`)

- Read-only root filesystem

- Non-root user

- Seccomp and AppArmor profiles

- `no-new-privileges` security option

## `docker-compose.yml`

```yaml
services:
  secure-app:
    image: alpine
    container_name: secure-alpine
    command: [ "sleep", "infinity" ]
    
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE  # Allows binding to ports like 80/443 if needed
    
    read_only: true
    tmpfs:
      - /tmp

    security_opt:
      - no-new-privileges:true
      - seccomp=/etc/docker/seccomp.json     # Optional: needs valid seccomp profile
      - apparmor=docker-default              # Optional: ensure AppArmor is enabled

    user: "1000:1000"                         # Run as non-root user
    restart: unless-stopped
    network_mode: "bridge"

    volumes:
      - type: tmpfs
        target: /run
      - ./logs:/var/log/app:ro               # Mount logs read-only

```

---

## Key Features Explained

| Setting                     | Description                                                                      |
| --------------------------- | -------------------------------------------------------------------------------- |
| `cap_drop: ALL`             | Drops all Linux capabilities by default                                          |
| `cap_add: NET_BIND_SERVICE` | Re-adds only whatâ€™s necessary (e.g., bind port 80)                               |
| `read_only: true`           | Prevents writes to root filesystem                                               |
| `tmpfs`                     | Ephemeral, in-memory writable directory (for `/tmp`, `/run`, etc.)               |
| `security_opt`              | Enables seccomp filtering, AppArmor enforcement, and blocks privilege escalation |
| `user: 1000:1000`           | Enforces least privilege by avoiding UID 0                                       |
| `volumes`                   | Controls mount types and read/write access                                       |

---

## Requirements

Before using this Compose file:

1. **Seccomp Profile**:
   
   - Copy Docker's default profile:
     
     bash
     
     CopyEdit
     
     `cp /usr/share/docker/seccomp.json /etc/docker/seccomp.json`

2. **AppArmor**:
   
   - Ensure AppArmor is installed:
     
     bash
     
     CopyEdit
     
     `sudo apt install apparmor apparmor-utils`
   
   - Ensure `docker-default` profile is active or create your own.

3. **Non-root User Setup**:
   
   - If using a base image like Alpine, create the user with UID 1000 if not present.
