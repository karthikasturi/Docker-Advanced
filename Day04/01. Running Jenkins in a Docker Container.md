# Running Jenkins in a Docker Container

## Prerequisites

- Docker installed on the host machine
- Port 8080 should be free
- Optional: Docker volume to persist Jenkins data

---

## Step-by-Step Guide

### Step 1: Create Docker Volume (Optional but Recommended)

```bash
docker volume create jenkins_data
```

## Step 2: Run Jenkins Container

```bash
docker run -d --name jenkins -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock jenkins/jenkins:lts
```

## Explanation:

- `-p 8080:8080`: Jenkins UI port

- `-p 50000:50000`: For agent connections

- `-v jenkins_data`:/var/jenkins_home: Persistent Jenkins home

- `-v /var/run/docker.sock:/var/run/docker.sock`: Allow Jenkins to run Docker commands

## Step 3: Access Jenkins UI

Open your browser and go to: [http://localhost:8080](http://localhost:8080)

## Step 4: Unlock Jenkins

Run the following command to get the initial admin password:

```bash
docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
```

## Step 5: Install Suggested Plugins

- Paste the password in the browser

- Install suggested plugins

- Create your first admin user

## Jenkins is Ready!

You can now create and run Jenkins pipelines using the containerized setup.

## To Stop and Remove Jenkins Container

```bash
docker stop jenkins
docker rm jenkins
```

## To Delete the Volume (if needed)

```bash
docker volume rm jenkins_data
```

## Steps to Configure Jenkins slave agent:

Refer: https://hub.docker.com/r/jenkins/inbound-agent/

<TBD>

## Run Jenkins Slave Agent(Linux):

```bash
docker run --init -d jenkins/inbound-agent -url http://<jenkins-master>:<port> -workDir=/home/jenkins/agent -secret <secret> -name agent1
```

# Basic Steps to Build a CI/CD Pipeline in Jenkins

## 1. Install Required Jenkins Plugins

- Go to: `Manage Jenkins` → `Manage Plugins`
- Install:
  - **Pipeline**
  - **Git**
  - **Docker Pipeline**
  - **Blue Ocean** (Optional UI enhancement)

---

## 2. Create a New Pipeline Job

1. Click on **"New Item"**
2. Enter a name (e.g., `my-docker-pipeline`)
3. Select **"Pipeline"** and click OK

---

## 3. Configure Source Code Repository

- In the pipeline config:
  - Go to **"Pipeline"** section
  - Set **Definition** to: `Pipeline script from SCM`
  - Choose `Git`
  - Enter your GitHub repository URL
  - Add credentials if private

---

## 4. Add Jenkinsfile to Your Git Repo

Create a file named `Jenkinsfile` in the root of your repo with a basic pipeline:

```groovy
pipeline {
  agent any

  stages {
    stage('Clone') {
      steps {
        git 'https://github.com/your/repo.git'
      }
    }

    stage('Build') {
      steps {
        sh 'docker build -t myapp:latest .'
      }
    }

    stage('Test') {
      steps {
        sh 'docker run --rm myapp:latest pytest'
      }
    }

    stage('Push') {
      steps {
        withCredentials([usernamePassword(credentialsId: 'dockerhub-creds', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
          sh '''
            echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
            docker push myapp:latest
          '''
        }
      }
    }
  }
}
```

## 5. Add Docker Hub Credentials

- Go to: Manage Jenkins → Credentials

- Add:
  
  - Kind: Username and password
  
  - ID: dockerhub-creds (used in Jenkinsfile)

## 6. Run the Pipeline

- Go to the job and click "Build Now"

- Monitor progress in "Console Output"

## Result

- Code is cloned

- Docker image is built and tested

- Image is pushed to Docker Hub

- Pipeline is fully automated
