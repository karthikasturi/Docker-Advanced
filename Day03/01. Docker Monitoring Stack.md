# Docker Monitoring Stack: cAdvisor + Prometheus + Grafana

This guide explains how to set up a container monitoring stack using:

- **cAdvisor** (to collect container metrics)
- **Prometheus** (to store and query metrics)
- **Grafana** (to visualize metrics)

---

## Prerequisites

- Docker and Docker Compose installed
- Internet access to pull images

---

## Directory Structure

```bash
monitoring/
├── docker-compose.yml
└── prometheus.yml
```

## Step 1: Create docker-compose.yml

```yaml
services:

  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: cadvisor
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:rw
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    restart: unless-stopped

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    restart: unless-stopped

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "3000:3000"
    restart: unless-stopped
```

## Step 2: Create prometheus.yml

```yaml
global:
 scrape_interval: 5s

scrape_configs:

- job_name: 'cadvisor'
  static_configs:
  - targets: ['cadvisor:8080']
```

## Step 3: Start the Monitoring Stack

Run the following command in the monitoring/ directory:

```bash
docker compose up -d
```

## Step 4: Access the Tools

| Tool       | URL                                             | Default Credentials |
| ---------- | ----------------------------------------------- | ------------------- |
| cAdvisor   | [http://localhost:8080](http://localhost:8080/) | N/A                 |
| Prometheus | [http://localhost:9090](http://localhost:9090/) | N/A                 |
| Grafana    | [http://localhost:3000](http://localhost:3000/) | admin / admin       |

## Step 5: Configure Grafana

1. Go to Grafana → Connections → Add Data Sources

2. Choose Prometheus

3. Set URL as http://prometheus:9090

4. Click Save & Test

## Step 6: Import Docker Monitoring Dashboard

1. Go to Dashboards → New button → Import

2. Use one of the following dashboard IDs:
   
   - 893 (Docker & system monitoring)
   
   - 179 (cAdvisor metrics)

3. Select the Prometheus data source and import.

## Validation

- Metrics should start appearing in Prometheus and Grafana

- You can create panels for:
  
  - Container CPU and memory usage
  
  - Container uptime
  
  - Disk and network IO

## Clean Up (Optional)

```bash
docker compose down
```

## Tips

- You can monitor other containers by adding more target entries in prometheus.yml

- Use alerting rules in Prometheus or Grafana for proactive alerts

- You can persist Grafana dashboards and Prometheus data using volumes
