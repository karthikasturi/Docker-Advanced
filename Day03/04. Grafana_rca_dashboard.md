# Grafana RCA-Ready Dashboard Setup Guide

This guide outlines steps to configure a comprehensive Grafana dashboard for monitoring a web application stack with metrics and logs, designed for RCA (Root Cause Analysis) readiness.

---

## ðŸ”¹ 1. Metric Alerts (CPU/Memory Thresholds)

### CPU Usage Alert

1. **Create Panel**: Dashboard â†’ + Create â†’ Add panel.

2. **Query** (Prometheus):
   
   ```promql
   sum(rate(container_cpu_usage_seconds_total{image!=""}[1m])) by (container)
   ```

3. **Set Alert**:
   
   - Navigate to **Alert** tab.
   
   - Add alert rule:
     
     ```text
     WHEN avg() OF query(A, 5m, now) IS ABOVE 0.75
     ```

### Memory Usage Alert

1. Use query:
   
   ```promql
   sum(container_memory_usage_bytes{image!=""}) by (container)
   ```

2. Set thresholds for alerting (e.g., above 500MiB).

---

## ðŸ”¹ 2. Log Stream Panel (By Container Name)

### Setup Logs Panel

1. **Data source**: Loki.

2. **LogQL Query** example:
   
   ```logql
   {container_name=~".*web.*"} |= "GET"
   ```

3. **Customize Panel** title, formatting, and filters.

---

## ðŸ”¹ 3. Time Range Selector

- Use the **time range selector** in the top-right of Grafana.
- Ensure all panels use **Dashboard Time**.
- Enables log and metric correlation during incidents.

---

## ðŸ”¹ 4. Status of Services and Database

### Service Uptime

Prometheus Query:

```promql
up{job="cadvisor"}
```

### Container Restart Count

```promql
rate(container_restart_count[5m])
```

### PostgreSQL Status (optional)

Requires `postgres_exporter`. Example query:

```promql
pg_stat_activity_count{datname="appdb"}
```

---

## ðŸ”¹ 5. Optional: RCA Summary Panel

### Example Stat Panel

Prometheus Query:

```promql
sum(rate(container_cpu_usage_seconds_total[5m]))
```

- Add color thresholds:
  - < 0.5 â†’ Green
  - 0.5â€“0.75 â†’ Yellow
  - > 0.75 â†’ Red

---

## ðŸ“Š Suggested Dashboard Layout

| Section            | Panel Type  | Data Source |
| ------------------ | ----------- | ----------- |
| CPU Usage          | Time Series | Prometheus  |
| Memory Usage       | Time Series | Prometheus  |
| Container Restarts | Stat        | Prometheus  |
| Web App Logs       | Log Panel   | Loki        |
| PostgreSQL Uptime  | Stat/Graph  | Prometheus  |
| Log Filter by Name | Variable    | Loki        |
| Time Correlation   | Global      | Dashboard   |

---

> This setup ensures a single-pane-of-glass view for your application health and logs, making incident investigation and root cause analysis faster and more effective.
